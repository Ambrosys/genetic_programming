git:
  depth: 200

language: cpp

compiler:
  - gcc
  # disabling clang, because libcxx yields errors
  # - clang

os: 
  - linux
  - osx

env:
  global:
    - GCC_VERSION="4.9"
    - secure: "O6wBD6n4jqULZr92bdctOqXausjRbebOo2MNXODYYlQdzrmjwef3EzNOdObhQe8t8ivbVYph0RO1cl+Pjwhh1F/6qWQcRNS957ZsFmL3+0CVX9g1zZRa2Sz+FDoxQFi5MEpTkcjgZeGpX9VW7zjheIAtRRatTBj9pyxVptqne5o="
  matrix:
    - BUILD_TYPE=Debug
    - BUILD_TYPE=Release

matrix:
  exclude:
    - os: osx   # For now disable gcc on osx as g++4.8 is not yet available
      compiler: gcc
  include:
    - os: linux
      compiler: gcc
      env: COVERITY_PUSH=1
    # COVERITY
    # COVERALL
    # DOCS

    
    
before_install:
  - export GPCXX_ROOT=`pwd`
  - cd $GPCXX_ROOT
  - if [ "$CXX" == "g++" ] && [ "$BUILD_TYPE" == "Debug" ]; then export MASTER_BUILD=1; fi
  - .ci/setup_compiler.sh
  - .ci/init_thirdparty.sh
  # some variables need to be set here
  - export BOOST_ROOT="$GPCXX_ROOT/third_party/boost"
  - if [ "$CXX" == "g++" ]; then export CXX="g++-${GCC_VERSION}" CC="gcc-${GCC_VERSION}"; fi

install:
  - cd $GPCXX_ROOT
  - mkdir build

script:
  - cd $GPCXX_ROOT
  - if [ -z "$COVERITY_PUSH" ]; then .ci/build_and_test.sh; fi
  # - cd $GPCXX_ROOT
  # - if [ -n "$COVERITY_PUSH" ]; then .ci/commit_coverity_scan.sh; fi
  
after_success:
  - cd $GPCXX_ROOT
  - if [ -n "$MASTER_BUILD" ]; then echo "Master build"; fi
  # - if in master: build docs and push to gh-page
  # - if in master: push to coverity branch
  # coveralls




addons:
  coverity_scan:
    project:
      name: "Ambrosys/gpcxx"
      description: "Build submitted via Travis CI"
    notification_email: karsten.ahnert@gmx.de
    build_command_prepend: "cd build && cmake .. -DGPCXX_BUILD_DOCS=OFF"
    build_command:   "make"
    branch_pattern: coverity_scan
